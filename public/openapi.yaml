openapi: 3.0.0
info:
  title: GEO ä¼˜åŒ–å™¨ API
  description: |
    è¿™æ˜¯ä¸€ä¸ªé¢å‘ç”Ÿæˆå¼å¼•æ“ä¼˜åŒ– (GEO) çš„å·¥å…· APIã€‚
    ä¸»è¦æä¾›ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š
    1. **è®¿é—® (GEO Access)**: æ¨¡æ‹Ÿ AI è®¿é—®ï¼Œæ ¹æ®è®¿é—®è€…èº«ä»½ï¼ˆAI/äººç±»ï¼‰æ™ºèƒ½è¿”å›ä¼˜åŒ–åçš„å†…å®¹ã€‚
    2. **è§£æ (Parse)**: å°†ä»»æ„ç½‘é¡µè½¬æ¢ä¸ºç»“æ„åŒ–ä¸­é—´è¡¨ç¤º (IR) å’Œ AI å‹å¥½çš„ HTMLã€‚

  version: 1.0.0
  contact:
    name: GEO ä¼˜åŒ–å™¨
    url: https://github.com/XuZhaoTong/deeplumen-homework
  license:
    name: MIT

servers:
  - url: http://localhost:3000
    description: æœ¬åœ°å¼€å‘ç¯å¢ƒ
  - url: https://deeplumen-homework.vercel.app
    description: ç”Ÿäº§ç¯å¢ƒ

tags:
  - name: GEO
    description: æ ¸å¿ƒ GEO è®¿é—®æ¥å£
  - name: Parse
    description: åŸºç¡€è§£ææœåŠ¡

paths:
  /api/geo/{slug}:
    get:
      tags:
        - GEO
      summary: è·å– GEO ä¼˜åŒ–é¡µé¢ (æ™ºèƒ½è·¯ç”±)
      description: |
        è®¿é—®ç›®æ ‡ç½‘é¡µçš„ GEO ç‰ˆæœ¬ã€‚ç³»ç»Ÿä¼šæ ¹æ®è¯·æ±‚ç‰¹å¾è‡ªåŠ¨åˆ¤æ–­ï¼š
        - **AI è®¿é—®**: è¿”å›æ¸…æ´—åçš„ã€ç»“æ„åŒ–çš„ GEO HTMLï¼ˆå»å™ªã€è¯­ä¹‰åŒ–ï¼‰ã€‚
        - **äººç±»è®¿é—®**: è¿”å›å‹å¥½çš„æç¤ºé¡µé¢æˆ–é‡å®šå‘ã€‚

        ### ğŸ¤– AI è®¿é—®æ£€æµ‹æœºåˆ¶
        æ¥å£ä¼šæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æ£€æµ‹æ˜¯å¦ä¸º AI è®¿é—®ï¼ˆæ»¡è¶³ä»»ä¸€æ¡ä»¶å³å¯ï¼‰ï¼š

        1. **Query å‚æ•°** (æœ€æ˜“äºæµ‹è¯•):
           - `?ai=true` æˆ– `?format=geo`
        2. **è‡ªå®šä¹‰ Header**:
           - `X-AI-Request: true` æˆ– `X-Bot-Type: llm`
        3. **User-Agent**:
           - è‡ªåŠ¨åŒ¹é… `GPTBot`, `ClaudeBot`, `Google-Extended` ç­‰å·²çŸ¥ AI çˆ¬è™«æŒ‡çº¹ã€‚
      parameters:
        - name: slug
          in: path
          required: true
          description: ç›®æ ‡åŸŸåæˆ–è·¯å¾„å ä½ç¬¦
          schema:
            type: string
          # ğŸŸ¢ æ–¹ä¾¿è°ƒè¯•ï¼šé»˜è®¤å¡«å…¥ example.com
          example: example.com

        - name: url
          in: query
          required: false
          description: (å¯é€‰) å®Œæ•´çš„ç‰¹å®š URLï¼Œå¦‚æœæä¾›æ­¤å‚æ•°å°†è¦†ç›– path ä¸­çš„ slug
          schema:
            type: string
          # ğŸŸ¢ æ–¹ä¾¿è°ƒè¯•ï¼šæä¾›ä¸€ä¸ªçœŸå®çš„é•¿é“¾æ¥
          example: https://news.qq.com/rain/a/20260117A05C9M00

        - name: ai
          in: query
          required: false
          description: (è°ƒè¯•ç”¨) å¼ºåˆ¶å¼€å¯ AI æ¨¡å¼ï¼Œè·³è¿‡ UA æ£€æµ‹
          schema:
            type: boolean
          # ğŸŸ¢ æ–¹ä¾¿è°ƒè¯•ï¼šé»˜è®¤å¼€å¯ï¼Œç‚¹å‡» Execute å³å¯çœ‹åˆ° GEO æ•ˆæœ
          example: true

      responses:
        '200':
          description: æˆåŠŸè¿”å› HTML å†…å®¹
          headers:
            X-GEO-Optimized:
              description: æ ‡è¯†æ˜¯å¦ä¸º GEO ä¼˜åŒ–é¡µé¢
              schema:
                type: boolean
            X-AI-Service:
              description: è¯†åˆ«åˆ°çš„ AI æœåŠ¡å•† (å¦‚ OpenAI, Google)
              schema:
                type: string
          content:
            text/html:
              schema:
                type: string
                example: "<!DOCTYPE html><html lang='zh-CN'>...</html>"
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/parse:
    post:
      tags:
        - Parse
      summary: è§£æç½‘é¡µ (è·å– IR ä¸ GEO æ•°æ®)
      description: |
        æ‰§è¡Œå®Œæ•´çš„ GEO å¤„ç†æµç¨‹ï¼š
        `Fetch HTML` â†’ `Clean` â†’ `Generate IR` â†’ `Generate GEO HTML`
        
        è¿”å›åŒ…å«ä¸­é—´è¡¨ç¤º (IR) å’Œæœ€ç»ˆ HTML çš„ JSON æ•°æ®ï¼Œé€šå¸¸ç”¨äºè°ƒè¯•æˆ–åç«¯é›†æˆã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
              properties:
                url:
                  type: string
                  description: éœ€è¦è§£æçš„ç›®æ ‡ç½‘é¡µ URL
                  example: https://news.qq.com/rain/a/20260117A05C9M00
      responses:
        '200':
          description: è§£ææˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParseResponse'
        '400':
          description: URL æ— æ•ˆæˆ–ç¼ºå¤±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: æœåŠ¡å™¨è§£æé”™è¯¯

components:
  schemas:
    IR:
      type: object
      description: ä¸­é—´è¡¨ç¤º(Intermediate Representation)
      required:
        - metadata
        - content
        - semantic
      properties:
        metadata:
          type: object
          description: é¡µé¢å…ƒæ•°æ®
          required:
            - url
            - title
            - excerpt
          properties:
            url:
              type: string
              format: uri
              description: é¡µé¢ URL
            title:
              type: string
              description: é¡µé¢æ ‡é¢˜
            author:
              type: string
              description: ä½œè€…
            publishDate:
              type: string
              format: date-time
              description: å‘å¸ƒæ—¥æœŸ
            excerpt:
              type: string
              description: æ‘˜è¦
            siteName:
              type: string
              description: ç½‘ç«™åç§°
            lang:
              type: string
              description: è¯­è¨€ä»£ç 
              example: zh-CN
        content:
          type: object
          description: é¡µé¢å†…å®¹
          required:
            - headings
            - paragraphs
            - images
          properties:
            headings:
              type: array
              description: æ ‡é¢˜åˆ—è¡¨
              items:
                type: object
                properties:
                  level:
                    type: integer
                    minimum: 1
                    maximum: 6
                    description: æ ‡é¢˜çº§åˆ«(1-6)
                  text:
                    type: string
                    description: æ ‡é¢˜æ–‡æœ¬
                  id:
                    type: string
                    description: HTML ID(å¯é€‰)
            paragraphs:
              type: array
              description: æ®µè½åˆ—è¡¨
              items:
                type: string
            images:
              type: array
              description: å›¾ç‰‡åˆ—è¡¨
              items:
                type: object
                required:
                  - src
                  - alt
                properties:
                  src:
                    type: string
                    format: uri
                    description: å›¾ç‰‡ URL
                  alt:
                    type: string
                    description: æ›¿ä»£æ–‡æœ¬
                  caption:
                    type: string
                    description: å›¾ç‰‡è¯´æ˜
                  width:
                    type: integer
                    description: å®½åº¦(åƒç´ )
                  height:
                    type: integer
                    description: é«˜åº¦(åƒç´ )
            lists:
              type: array
              description: åˆ—è¡¨(å¯é€‰)
              items:
                type: object
                properties:
                  type:
                    type: string
                    enum: [ul, ol]
                    description: åˆ—è¡¨ç±»å‹
                  items:
                    type: array
                    items:
                      type: string
            videos:
              type: array
              description: è§†é¢‘(å¯é€‰)
              items:
                type: object
                properties:
                  src:
                    type: string
                    format: uri
                  poster:
                    type: string
                    format: uri
                  caption:
                    type: string
        semantic:
          type: object
          description: è¯­ä¹‰ä¿¡æ¯
          required:
            - mainEntityType
          properties:
            mainEntityType:
              type: string
              enum: [Product, Article, BlogPosting, NewsArticle, WebPage, Person, Organization, Event]
              description: Schema.org å®ä½“ç±»å‹
            keywords:
              type: array
              description: å…³é”®è¯
              items:
                type: string
            readingTime:
              type: integer
              description: é˜…è¯»æ—¶é—´(åˆ†é’Ÿ)
            wordCount:
              type: integer
              description: å­—æ•°
        raw:
          type: object
          description: åŸå§‹æ•°æ®(å¯é€‰)
          properties:
            textContent:
              type: string
            htmlContent:
              type: string
            length:
              type: integer

    ParseResponse:
      type: object
      description: è§£æå“åº”
      required:
        - success
      properties:
        success:
          type: boolean
          description: æ˜¯å¦æˆåŠŸ
        ir:
          $ref: '#/components/schemas/IR'
        geoHTML:
          type: string
          description: ç”Ÿæˆçš„ GEO HTML
        originalHTML:
          type: string
          description: åŸå§‹ HTML(å¯é€‰)
        originalTitle:
          type: string
          description: åŸå§‹æ ‡é¢˜
        processingTime:
          type: integer
          description: å¤„ç†è€—æ—¶(æ¯«ç§’)
        error:
          type: string
          description: é”™è¯¯ä¿¡æ¯(å¤±è´¥æ—¶)

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: é”™è¯¯æè¿°
